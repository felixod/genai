{"version":3,"file":"autotag.min.js","sources":["../src/autotag.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for the AutoTag feature.\n *\n * @module     qbank_genai/autotag\n * @copyright  2025 Christian Gr√©visse <christian.grevisse@uni.lu>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Selectors from 'qbank_genai/selectors';\n\nclass AutoTag {\n    constructor(questionlist) {\n        this.questionlist = questionlist;\n        this.registerEventListeners();\n        this.hideMessage();\n    }\n\n    registerEventListeners() {\n        const tagger = document.querySelector(Selectors.ELEMENTS.AUTOTAGBUTTON);\n        if (tagger) {\n            tagger.addEventListener('click', async() => {\n\n                this.hideMessage();\n\n                tagger.setAttribute('disabled', 'disabled');\n                const oldText = tagger.innerHTML;\n                tagger.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i>';\n\n                const request = {\n                    methodname: 'qbank_genai_autotag_questions',\n                    args: {\n                        questionlist: this.questionlist,\n                    }\n                };\n\n                try {\n                    const responseObj = await Ajax.call([request])[0];\n                    if (responseObj.error) {\n                        this.showMessage(responseObj.error.exception.message, true);\n                    } else {\n                        this.showMessage(responseObj, false);\n                    }\n                } catch (error) {\n                    this.showMessage(error.message, true);\n                } finally {\n                    tagger.removeAttribute('disabled');\n                    tagger.innerHTML = oldText;\n                }\n            });\n        }\n    }\n\n    showMessage(message, error) {\n        const errorField = document.querySelector(Selectors.ELEMENTS.RESULTFIELD);\n        if (errorField) {\n            errorField.innerHTML = message;\n            errorField.style.display = 'block';\n            errorField.classList.add(error ? 'alert-danger' : 'alert-info');\n        }\n    }\n\n    hideMessage() {\n        const errorField = document.querySelector(Selectors.ELEMENTS.RESULTFIELD);\n        if (errorField) {\n            errorField.innerHTML = '';\n            errorField.style.display = 'none';\n            errorField.classList.remove('alert-info', 'alert-danger');\n        }\n    }\n}\n\nexport const init = (questionlist) => {\n    new AutoTag(questionlist);\n};\n"],"names":["AutoTag","constructor","questionlist","registerEventListeners","hideMessage","tagger","document","querySelector","Selectors","ELEMENTS","AUTOTAGBUTTON","addEventListener","async","setAttribute","oldText","innerHTML","request","methodname","args","this","responseObj","Ajax","call","error","showMessage","exception","message","removeAttribute","errorField","RESULTFIELD","style","display","classList","add","remove"],"mappings":";;;;;;;0KA0BMA,QACFC,YAAYC,mBACHA,aAAeA,kBACfC,8BACAC,cAGTD,+BACUE,OAASC,SAASC,cAAcC,mBAAUC,SAASC,eACrDL,QACAA,OAAOM,iBAAiB,SAASC,eAExBR,cAELC,OAAOQ,aAAa,WAAY,kBAC1BC,QAAUT,OAAOU,UACvBV,OAAOU,UAAY,8CAEbC,QAAU,CACZC,WAAY,gCACZC,KAAM,CACFhB,aAAciB,KAAKjB,yBAKjBkB,kBAAoBC,cAAKC,KAAK,CAACN,UAAU,GAC3CI,YAAYG,WACPC,YAAYJ,YAAYG,MAAME,UAAUC,SAAS,QAEjDF,YAAYJ,aAAa,GAEpC,MAAOG,YACAC,YAAYD,MAAMG,SAAS,WAEhCrB,OAAOsB,gBAAgB,YACvBtB,OAAOU,UAAYD,YAMnCU,YAAYE,QAASH,aACXK,WAAatB,SAASC,cAAcC,mBAAUC,SAASoB,aACzDD,aACAA,WAAWb,UAAYW,QACvBE,WAAWE,MAAMC,QAAU,QAC3BH,WAAWI,UAAUC,IAAIV,MAAQ,eAAiB,eAI1DnB,oBACUwB,WAAatB,SAASC,cAAcC,mBAAUC,SAASoB,aACzDD,aACAA,WAAWb,UAAY,GACvBa,WAAWE,MAAMC,QAAU,OAC3BH,WAAWI,UAAUE,OAAO,aAAc,gCAKjChC,mBACbF,QAAQE"}